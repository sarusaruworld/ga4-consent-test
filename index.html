<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>同意モードテスト（複数種別・汎用版）</title>

  <!-- ▼ ブリッジ用のスクリプトを先に定義 ▼ -->
  <script>
    // gtag() を定義して dataLayer に push するだけの軽量ブリッジ
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
  </script>

  <!-- ▼ Google Tag Manager (HEAD部) ▼ -->
  <script>
    (function(w,d,s,l,i){
      w[l]=w[l]||[];
      w[l].push({'gtm.start': new Date().getTime(), event:'gtm.js'});
      var f=d.getElementsByTagName(s)[0],
          j=d.createElement(s), dl=l!='dataLayer'?'&l='+l:'';
      j.async=true;
      j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
      f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-W8J5HDXW');
  </script>
  <!-- ▲ End Google Tag Manager (HEAD部) ▲ -->

  <style>
    .consent-group {
      border: 1px solid #ccc;
      padding: 1em;
      margin: 1em 0;
      display: inline-block;
    }
    .consent-group h2 {
      margin-top: 0;
    }
    button {
      margin-right: 1em;
    }
  </style>
</head>
<body>
  <!-- ▼ Google Tag Manager (noscript) ▼ -->
  <noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W8J5HDXW"
            height="0" width="0"
            style="display:none;visibility:hidden"></iframe>
  </noscript>
  <!-- ▲ End Google Tag Manager (noscript) ▲ -->

  <h1>Google 同意モード テストページ（複数種別・汎用版）</h1>
  <p>下のリストに含まれる主な同意モード種別をそれぞれ「同意する／拒否する」で切り替えできます。</p>

  <!-- 動的に生成したボタンを挿入するコンテナ -->
  <div id="consentList"></div>

  <script>
    // 同意モードの主な種別をまとめて管理
    const CONSENT_TYPES = [
      { key: 'analytics_storage',       label: 'Analytics Storage' },
      { key: 'ad_storage',             label: 'Ad Storage' },
      { key: 'functionality_storage',  label: 'Functionality Storage' },
      { key: 'personalization_storage',label: 'Personalization Storage' },
      { key: 'security_storage',       label: 'Security Storage' },
      { key: 'ad_user_data',           label: 'Ad User Data' },
      { key: 'ad_personalization',     label: 'Ad Personalization' }
    ];

    // ページ読み込み後にUIを組み立てる
    (function buildConsentUI() {
      const container = document.getElementById('consentList');

      CONSENT_TYPES.forEach(ct => {
        // 種別ごとに表示用ブロックを生成
        const groupDiv = document.createElement('div');
        groupDiv.className = 'consent-group';

        // タイトル
        const heading = document.createElement('h2');
        heading.textContent = ct.label;
        groupDiv.appendChild(heading);

        // 「同意する」ボタン
        const acceptBtn = document.createElement('button');
        acceptBtn.textContent = '同意する';
        // クリック時処理
        acceptBtn.addEventListener('click', () => {
          const updateObj = {};
          updateObj[ct.key] = 'granted';   // 同意を与える
          gtag('consent', 'update', updateObj);
          console.log(`[Consent Mode] ${ct.key} = granted`);
        });

        // 「拒否する」ボタン
        const rejectBtn = document.createElement('button');
        rejectBtn.textContent = '拒否する';
        // クリック時処理
        rejectBtn.addEventListener('click', () => {
          const updateObj = {};
          updateObj[ct.key] = 'denied';    // 同意を拒否
          gtag('consent', 'update', updateObj);
          console.log(`[Consent Mode] ${ct.key} = denied`);
        });

        // ボタンをDOMに追加
        groupDiv.appendChild(acceptBtn);
        groupDiv.appendChild(rejectBtn);

        // コンテナに追加
        container.appendChild(groupDiv);
      });
    })();
  </script>
</body>
</html>
